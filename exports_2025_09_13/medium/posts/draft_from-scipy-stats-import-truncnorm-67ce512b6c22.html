<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>from scipy.stats import truncnorm</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">from scipy.stats import truncnorm</h1>
</header>
<section data-field="subtitle" class="p-summary">
# https://stackoverflow.com/a/43641446/768439
</section>
<section data-field="body" class="e-content">
<section name="21f1" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="cd49" id="cd49" class="graf graf--h3 graf--empty graf--leading graf--title"><br></h3><p name="0b44" id="0b44" class="graf graf--p graf-after--h3">from scipy.stats import truncnorm</p><p name="7c76" id="7c76" class="graf graf--p graf-after--p"># <a href="https://stackoverflow.com/a/43641446/768439" data-href="https://stackoverflow.com/a/43641446/768439" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://stackoverflow.com/a/43641446/768439</a></p><p name="9d7c" id="9d7c" class="graf graf--p graf-after--p">def background_gradient(s, m=None, M=None, cmap=’Reds’, low=0, high=0):</p><p name="4bf1" id="4bf1" class="graf graf--p graf-after--p">if m is None:</p><p name="ea0f" id="ea0f" class="graf graf--p graf-after--p">m = s.min().min()</p><p name="d8fb" id="d8fb" class="graf graf--p graf-after--p">if M is None:</p><p name="710b" id="710b" class="graf graf--p graf-after--p">M = s.max().max()</p><p name="01f3" id="01f3" class="graf graf--p graf-after--p">rng = M — m</p><p name="dada" id="dada" class="graf graf--p graf-after--p">norm = colors.Normalize(m — (rng * low), M + (rng * high))</p><p name="7cfa" id="7cfa" class="graf graf--p graf-after--p">normed = s.apply(lambda x: norm(x.values))</p><p name="a12d" id="a12d" class="graf graf--p graf-after--p">cm = plt.cm.get_cmap(cmap)</p><p name="84ac" id="84ac" class="graf graf--p graf-after--p">c = normed.applymap(lambda x: colors.rgb2hex(cm(x)))</p><p name="bdc9" id="bdc9" class="graf graf--p graf-after--p">ret = c.applymap(lambda x: ‘background-color: %s’ % x)</p><p name="3915" id="3915" class="graf graf--p graf-after--p">return ret</p><p name="e439" id="e439" class="graf graf--p graf-after--p"># Firstly, we’ll be using scipy’s truncnorm instead of numpy random to avoid</p><p name="327d" id="327d" class="graf graf--p graf-after--p"># values &lt; 0 or &gt; 100</p><p name="a21f" id="a21f" class="graf graf--p graf-after--p"># Using: <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.truncnorm.html" data-href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.truncnorm.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.truncnorm.html</a></p><p name="7b6c" id="7b6c" class="graf graf--p graf-after--p">mean = 70</p><p name="840d" id="840d" class="graf graf--p graf-after--p">std = 20</p><p name="e757" id="e757" class="graf graf--p graf-after--p">min_clip = 0</p><p name="bebf" id="bebf" class="graf graf--p graf-after--p">max_clip = 100</p><p name="fa4c" id="fa4c" class="graf graf--p graf-after--p">a, b = (min_clip — mean) / std, (max_clip — mean) / std</p><p name="add8" id="add8" class="graf graf--p graf-after--p"># Generate marks for two classes (note that they’re of different sizes)</p><p name="98f3" id="98f3" class="graf graf--p graf-after--p">classA = pd.Series(truncnorm.rvs(a, b, loc=mean, scale=std, size=30))</p><p name="1966" id="1966" class="graf graf--p graf-after--p">classB = pd.Series(truncnorm.rvs(a, b, loc=mean, scale=std, size=30))</p><p name="b21a" id="b21a" class="graf graf--p graf-after--p"># I’m adding these to make sure we handle our edge cases correctly (more on it later)</p><p name="a4bd" id="a4bd" class="graf graf--p graf-after--p">idx = max(classA.index)</p><p name="ecf8" id="ecf8" class="graf graf--p graf-after--p">classA = classA.append(pd.Series([100, 0], index=[idx+1, idx+2]), verify_integrity=True)</p><p name="d45f" id="d45f" class="graf graf--p graf-after--p"># Quickly visualize the data</p><p name="9ab8" id="9ab8" class="graf graf--p graf-after--p">df = pd.DataFrame({‘classA’: classA, ‘classB’: classB})</p><p name="d7e3" id="d7e3" class="graf graf--p graf-after--p">df.plot.hist(alpha=0.5)</p><p name="3592" id="3592" class="graf graf--p graf-after--p"># display(df)</p><p name="9433" id="9433" class="graf graf--p graf-after--p"># Many binning strategies, but here we are using 10 bins between 0 and 100 explicitly. Look at docs for more</p><p name="9411" id="9411" class="graf graf--p graf-after--p">num_bins = 10</p><p name="aaf1" id="aaf1" class="graf graf--p graf-after--p">bins = [i * num_bins for i in range(num_bins + 1)]</p><p name="6ac3" id="6ac3" class="graf graf--p graf-after--p"># Figure out which bin every value is in</p><p name="9200" id="9200" class="graf graf--p graf-after--p">outA = pd.cut(classA, bins=bins, include_lowest=True, right=True)</p><p name="53a6" id="53a6" class="graf graf--p graf-after--p">outB = pd.cut(classB, bins=bins, include_lowest=True, right=True)</p><p name="3cc1" id="3cc1" class="graf graf--p graf-after--p"># Verify for personal understanding and validate the edge cases</p><p name="b037" id="b037" class="graf graf--p graf-after--p"># for idx, grade in classA.iteritems():</p><p name="0012" id="0012" class="graf graf--p graf-after--p"># print(idx, grade, outA[idx])</p><p name="64bf" id="64bf" class="graf graf--p graf-after--p"># Show the output of this</p><p name="9e46" id="9e46" class="graf graf--p graf-after--p"># <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.groupby.html" data-href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.groupby.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.groupby.html</a></p><p name="e66f" id="e66f" class="graf graf--p graf-after--p"># If a dict or Series is passed, the Series or dict VALUES will be used to determine the groups (the Series’ values are first aligned; see .align() method)</p><p name="7029" id="7029" class="graf graf--p graf-after--p"># type(out)</p><p name="3990" id="3990" class="graf graf--p graf-after--p"># pandas.core.series.Series</p><p name="bee6" id="bee6" class="graf graf--p graf-after--p"># Probability distribution analysis</p><p name="dd5e" id="dd5e" class="graf graf--p graf-after--p">classACounts = classA.groupby(outA).count()</p><p name="3c8f" id="3c8f" class="graf graf--p graf-after--p">classBCounts = classB.groupby(outB).count()</p><p name="250f" id="250f" class="graf graf--p graf-after--p">classATotalCount = classACounts.values.sum()</p><p name="f459" id="f459" class="graf graf--p graf-after--p">classBTotalCount = classACounts.values.sum()</p><p name="b34e" id="b34e" class="graf graf--p graf-after--p">totalCount = classATotalCount + classBTotalCount</p><p name="b078" id="b078" class="graf graf--p graf-after--p">classAPD = classACounts.apply(lambda c: c / classATotalCount)</p><p name="5bd9" id="5bd9" class="graf graf--p graf-after--p">classBPD = classBCounts.apply(lambda c: c / classBTotalCount)</p><p name="559c" id="559c" class="graf graf--p graf-after--p">pdProduct = np.matrix.round(np.multiply(classAPD.values.reshape(1,num_bins), classBPD.values.reshape(num_bins,1)), 2)</p><p name="2666" id="2666" class="graf graf--p graf-after--p"># Goal: Most of the weight is around the diagonal</p><p name="24c0" id="24c0" class="graf graf--p graf-after--p">df = pd.DataFrame(pdProduct, columns=axis, index=axis)</p><p name="22ba" id="22ba" class="graf graf--p graf-after--p">df.columns.name = “Class A”</p><p name="85c2" id="85c2" class="graf graf--p graf-after--p">df.index.name = “Class B”</p><p name="8dc7" id="8dc7" class="graf graf--p graf-after--p">df = df.style.set_caption(“Probability distribution product”).apply(background_gradient, high=1, axis=None)</p><p name="c0ae" id="c0ae" class="graf graf--p graf-after--p">display(df)</p><p name="0198" id="0198" class="graf graf--p graf-after--p"># Counts analysis</p><p name="92c3" id="92c3" class="graf graf--p graf-after--p">trans_matrix = [[0] * num_bins for _ in range(num_bins)]</p><p name="98d8" id="98d8" class="graf graf--p graf-after--p">for bA, cA in enumerate(classACounts.values.tolist()):</p><p name="6508" id="6508" class="graf graf--p graf-after--p">for bB, cB in enumerate(classBCounts.values.tolist()):</p><p name="9320" id="9320" class="graf graf--p graf-after--p">trans_matrix[bA][bB] = cA + cB</p><p name="1491" id="1491" class="graf graf--p graf-after--p">np_trans_matrix = np.matrix(trans_matrix)</p><p name="671b" id="671b" class="graf graf--p graf-after--p">delta_matrix = abs(np_trans_matrix — np_trans_matrix.transpose())</p><p name="5c54" id="5c54" class="graf graf--p graf-after--p">other_matrix = np.round(abs(np_trans_matrix — np_trans_matrix.transpose()) / (abs(np_trans_matrix + np_trans_matrix.transpose())), 2)</p><p name="9e17" id="9e17" class="graf graf--p graf-after--p"># Goal: Small numbers wherever possible</p><p name="d1c8" id="d1c8" class="graf graf--p graf-after--p">df = pd.DataFrame(np_trans_matrix, columns=axis, index=axis)</p><p name="0163" id="0163" class="graf graf--p graf-after--p">df.columns.name = “Class A”</p><p name="4833" id="4833" class="graf graf--p graf-after--p">df.index.name = “Class B”</p><p name="463e" id="463e" class="graf graf--p graf-after--p">df = df.style.set_caption(“Counts matrix abs(original — transpose)”).apply(background_gradient, high=1, axis=None)</p><p name="c773" id="c773" class="graf graf--p graf-after--p">display(df)</p><p name="629f" id="629f" class="graf graf--p graf--empty graf-after--p graf--trailing"><br></p></div></div></section>
</section>
<footer><p><a href="https://medium.com/p/67ce512b6c22">View original.</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 13, 2025.</p></footer></article></body></html>